# Cloudflare to AWS Edge Migration Tool | [ä¸­æ–‡](./README_CN.md)

**Automatically convert Cloudflare configurations to AWS edge service configurations through AI conversation**

---

## âš ï¸ CRITICAL: Required Input Format

**This tool ONLY works with configuration files generated by [CloudflareBackup](https://github.com/chenghit/CloudflareBackup).**

**âŒ NOT COMPATIBLE with [cf-terraforming](https://github.com/cloudflare/cf-terraforming) (Cloudflare's official tool)**

If you provide Terraform HCL files (`.tf`) generated by cf-terraforming, this tool's Skills will NOT activate. Any conversion attempt will rely solely on the underlying LLM's general capabilities without the specialized conversion logic, validation rules, and best practices encoded in this tool. Results will be unpredictable and unsupported.

**Why CloudflareBackup is required:**
- **Predictable file structure**: CloudflareBackup creates a standard directory structure with fixed file names (`WAF-Custom-Rules.txt`, `Rate-limits.txt`, `IP-Lists.txt`, etc.)
- **One-command backup**: Backs up all configurations in a single run with consistent organization
- **Skills-optimized**: File locations and naming conventions are designed for this tool's workflow

**Why cf-terraforming is not supported:**
- **Still requires API calls**: cf-terraforming cannot discover zone IDs from domain names - you must call the API anyway
- **Wrong output format**: Generates Terraform HCL code for managing Cloudflare, not configuration data for migration
- **More work, not less**: Requires multiple manual commands vs. one CloudflareBackup command
- **No practical benefit**: If you're calling the API anyway, CloudflareBackup gives you exactly what you need in one step

See [Why Not cf-terraforming?](#why-not-cf-terraforming) for detailed explanation.

---

## Why This Tool

Manually converting hundreds of rules when migrating from Cloudflare to AWS is time-consuming and error-prone. This tool leverages GenAI capabilities to automate batch configuration conversion through conversational interaction, reducing migration time from days to hours.

## Features Overview

This tool contains multiple independent Agent Skills, each focused on specific configuration conversion:

| Skill | Input | Output | Status |
|-------|-------|--------|--------|
| **cf-waf-converter** | Cloudflare security rules (WAF, Rate Limiting, IP Access, etc.) | AWS WAF configuration (Terraform) | âœ… Available |
| **cf-functions-converter** | Cloudflare transformation rules (Redirect, URL Rewrite, Header Transform, etc.) | CloudFront Functions (JavaScript) | âœ… Available |
| **cf-cdn-analyzer** | Cloudflare CDN configuration (Cache, Origin, Redirect, etc.) | Hostname-based configuration summary with user decision template | âœ… Available |

**Why Subagents?** Each skill runs in a separate Kiro subagent with isolated context. This prevents context pollution when handling complex multi-step conversions, especially for the upcoming CDN migration workflow (Skills 3-11) which requires parallel execution of multiple converter skills. See [Architecture Design](./docs/architecture/) for details.

## Recommended Configuration

### Model Selection

- **Default Configuration**: `claude-sonnet-4.5` (Kiro default)
  - Use case: < 100 rules
  - Sufficient for most migration scenarios

- **Large-Scale Configuration**: `claude-sonnet-4.5-1m`
  - Use case: > 100 rules OR multiple domains with complex configurations
  - **Recommended for CDN migration**: If you have 10+ proxied domains with various rules, use this model
  - Supports larger context window
  - Configuration: Use `/model` command in Kiro to switch

**Note for CDN Migration**: CDN configuration analysis (cf-cdn-analyzer) processes all rules across all proxied domains simultaneously. With many domains and rules, context size grows quickly. Using `claude-sonnet-4.5-1m` ensures sufficient context window.

### System Requirements

- Kiro CLI (command-line tool)
- Sufficient disk space for Cloudflare configuration backups

## Quick Start

```bash
# 1. Install Kiro CLI
curl -fsSL https://cli.kiro.dev/install | bash

# 2. Backup Cloudflare configuration
# Use the standalone backup tool: https://github.com/chenghit/CloudflareBackup
# Follow that repo's README for installation and usage

# 3. Clone this repository and install skills
git clone https://github.com/chenghit/cloudflare-aws-edge-config-converter.git
cd cloudflare-aws-edge-config-converter
./install.sh

# 4. Start Kiro CLI chat
kiro-cli chat

# 5. Switch to converter subagent and start conversion
# In the chat, use /agent swap command:
/agent swap cf-waf-converter

# Then provide the path to your Cloudflare configuration:
# "Convert security rules in /path/to/cloudflare-config"

# Or for transformation rules:
/agent swap cf-functions-converter
# "Convert transformation rules in /path/to/cloudflare-config"
```

## Prerequisites

### 1. Install Terraform

The AWS WAF configurations generated by this tool require Terraform 1.8.0 or higher.

```bash
# Check current version
terraform version

# If version is lower than 1.8.0, upgrade via:
# https://developer.hashicorp.com/terraform/install
```

**Important**: AWS Provider 6.x requires Terraform >= 1.8.0. Using a lower Terraform version will result in "Unrecognized remote plugin message" error during `terraform plan`.

### 2. Install Kiro

Follow official documentation:
- Kiro installation: https://kiro.dev/docs/getting-started/installation/

## Installation

Run the installation script to install skills and subagent configurations:

```bash
git clone https://github.com/chenghit/cloudflare-aws-edge-config-converter.git
cd cloudflare-aws-edge-config-converter
./install.sh
```

This will:
- Copy skills to `~/.kiro/skills/cloudflare-aws-converter/`
- Copy subagent configurations to `~/.kiro/agents/`

Installed subagents:
- `cf-waf-converter` - Converts Cloudflare security rules to AWS WAF
- `cf-functions-converter` - Converts Cloudflare transformation rules to CloudFront Functions

### Updating Skills

To update to the latest version:

```bash
cd cloudflare-aws-edge-config-converter
git pull
./install.sh
```

The install script will automatically replace old skills with new versions.

## Usage Guide

### Preparation: Backup Cloudflare Configuration

**Recommended Method** (Secure):

Use the standalone backup tool: **[CloudflareBackup](https://github.com/chenghit/CloudflareBackup)**

Follow that repo's README to complete Cloudflare configuration backup, then reference the backup directory path in Kiro for conversion.

**Why not provide API token in Kiro?**

Tokens remain in conversation history, posing a security risk. Using a standalone backup tool locally is more secure.

**Using Example Configurations** (For Testing):

If you want to test the tool without backing up your own configuration, you can use the example configurations provided:
- Location: `examples/cloudflare-configs/`
- Contains real Cloudflare configuration structure
- Can be used directly for testing conversion functionality

### Skill 1: Convert Security Rules to AWS WAF

**How to use**: Switch to `cf-waf-converter` subagent using `/agent swap cf-waf-converter`

**Example Conversation**:

```
User: /agent swap cf-waf-converter

Kiro: [Switches to WAF converter subagent]

User: Convert security rules in /path/to/cloudflare-config

Kiro: [Reads configuration files, generates rule summary]
      Please confirm if the following rule summary is correct...

User: Confirmed

Kiro: Please provide a Web ACL name for deployment

User: my-web-acl

Kiro: [Generates Terraform configuration files]
```

**Output Files**:

- `versions.tf` - Terraform and AWS Provider version constraints (requires AWS Provider >= 6.4.0)
- `main.tf` - Two Web ACL configurations (website and api-and-file)
- `variables.tf` - Variable definitions
- `terraform.tfvars` - Variable values
- `README_aws-waf-terraform-deployment.md` - Deployment guide

**Complete Example**: [examples/conversation-history/cloudflare-to-aws-waf.txt](examples/conversation-history/cloudflare-to-aws-waf.txt)

### Skill 2: Convert Transformation Rules to CloudFront Functions

**How to use**: Switch to `cf-functions-converter` subagent using `/agent swap cf-functions-converter`

**Example Conversation**:

```
User: /agent swap cf-functions-converter

Kiro: [Switches to Functions converter subagent]

User: Convert transformation rules in /path/to/cloudflare-config

Kiro: [Reads configuration files, generates rule summary]
      Please confirm if the following rule summary is correct...

User: Confirmed

Kiro: Please provide a CloudFront Function name

User: my-viewer-request-function

Kiro: [Generates JavaScript code and deployment guide]
```

**Output Files**:

- `cloudflare-transformation-rules-summary.md` - Rule summary
- `viewer-request-function.js` - CloudFront Function code
- `viewer-request-function.min.js` - Minified version (if needed)
- `key-value-store.json` - KVS data (if needed)
- `README_function_and_kvs_deployment.md` - Deployment guide

**Complete Example**: [examples/conversation-history/cloudflare-to-cloudfront-functions.txt](examples/conversation-history/cloudflare-to-cloudfront-functions.txt)

### Skill 3: Analyze CDN Configuration

**How to use**: Switch to `cf-cdn-analyzer` subagent using `/agent swap cf-cdn-analyzer`

**Example Conversation**:

```
User: /agent swap cf-cdn-analyzer

Kiro: [Switches to CDN analyzer subagent]

User: Analyze Cloudflare CDN config in /path/to/cloudflare-config

Kiro: [Reads configuration files, detects SaaS, groups rules by hostname]
      [Generates hostname-based-config-summary.md and README_1_analyzer.md]
      
      Please edit the "Proxied Hostnames" table in hostname-based-config-summary.md
      to indicate which hostnames need default cache behavior...
```

**Output Files**:

- `hostname-based-config-summary.md` - Configuration grouped by hostname with user decision template
- `README_1_analyzer.md` - Next steps guide

**What This Skill Does**:

- Detects SaaS configuration (terminates if found)
- Identifies proxied DNS records (each becomes a CloudFront Distribution)
- Detects IP-based origins (marks as non-convertible)
- Groups all rules by hostname following Cloudflare execution order
- Identifies implicit Cloudflare default cache behavior
- Generates user decision template for default cache behavior

**Next Steps**: Edit the summary file and run Planner skill (cf-cdn-planner) to determine CloudFront implementation methods.

**Note**: This is the first step in a multi-stage CDN migration workflow (Skills 3-11). See [Architecture Design](./docs/architecture/skill-3-11-design-EN.md) for complete workflow.

## Best Practices

### âœ… Recommended Practices

1. **Use Separate Subagents for Different Tasks**
   - Use `/agent swap cf-waf-converter` for security rules
   - Use `/agent swap cf-functions-converter` for transformation rules
   - Use `/agent swap cf-cdn-analyzer` for CDN configuration analysis
   - Each subagent has isolated context to avoid confusion

2. **Convert One Project at a Time**
   - After completing conversion for one domain, start a new chat session
   - Avoid mixing configurations from multiple projects

3. **Provide Clear File Paths**
   - Always specify the full path to your Cloudflare configuration directory
   - Example: "Convert security rules in /Users/me/cloudflare-backup/example.com/2026-01-12"

4. **Validate Generated Summaries**
   - Kiro will generate rule summaries for your confirmation
   - Carefully review summaries to ensure correct understanding
   - Correct issues promptly if found

### âŒ Practices to Avoid

1. **Don't Convert Multiple Projects in the Same Conversation**
   - Causes context confusion
   - AI may hallucinate and mix configurations from different projects

2. **Don't Mix Different Rule Type Conversions**
   - Example: Converting both WAF and CloudFront Functions in the same conversation
   - Use separate subagents for different conversion types

3. **Don't Use Vague Descriptions**
   - Avoid: "Help me convert Cloudflare configuration" (unclear what to convert)
   - Use: "Convert Cloudflare security rules to AWS WAF configuration" (specific and clear)

## Limitations and Caveats

### Content Not Converted

* **Managed Rules**
  - Reason: AWS WAF doesn't support Cloudflare-specific features (e.g., API Abuse Detection)
  - Alternative: Directly add managed rules in AWS WAF (Anti-DDoS, Core Rule Set, Bot Control, etc.)
  - These standardized configurations don't require AI conversion, avoiding hallucinations

* **Page Rules (Deprecated)**
  - Reason: Cloudflare has deprecated Page Rules functionality
  - Recommendation: First migrate to modern rule types in Cloudflare (Redirect Rules, URL Rewrite Rules, etc.), then use this tool for conversion

* **Some Advanced Transformation Rules**
  - Reason: Cloudflare and CloudFront features are not one-to-one
  - Note: Tool will list unconvertible rules and alternatives in generated documentation

### Large-Scale Configuration Considerations

* **Token Consumption**
  - Token consumption increases significantly with > 100 rules
  - May affect conversion quality
  - Recommendation: Use `claude-sonnet-4.5-1m` model, or convert in batches

* **Conversion Time**
  - More rules = longer conversion time
  - Typical: ~5-10 minutes for 50 rules

### Conversion Accuracy

* **Manual Review Required**
  - AI-generated configurations require manual review
  - Especially for complex conditional logic and regular expressions
  - Recommend validation in test environment first

* **Edge Cases**
  - Some complex nested conditions may require manual adjustment
  - Tool will mark areas requiring attention in documentation

## Troubleshooting

### Subagent Not Switching

**Problem**: `/agent swap` command doesn't work or subagent not found

**Solution**:
1. Verify installation: Check if `~/.kiro/agents/cf-waf-converter.json` exists
2. Restart Kiro CLI: Exit and start a new `kiro-cli chat` session
3. List available agents: Use `/agent list` to see installed subagents

### Conversion Results Don't Meet Expectations

**Problem**: Generated configuration doesn't match expectations

**Solution**:
1. Check if Cloudflare configuration files are complete
2. Confirm if rule summary stage correctly understood the configuration
3. Try converting again in a new conversation
4. Consider converting complex configurations in batches

### Context Confusion

**Problem**: AI mixes different projects or different rule types

**Solution**:
1. Stop current conversation immediately
2. Start a new conversation with `/agent swap` to the correct subagent
3. Convert only one type of rule for one project at a time

## Why Not cf-terraforming?

[cf-terraforming](https://github.com/cloudflare/cf-terraforming) is Cloudflare's official tool for exporting configurations to Terraform. While it's excellent for Terraform-based infrastructure management, it's fundamentally incompatible with this migration tool.

### The Fatal Flaw: You Still Need the API

**cf-terraforming requires zone IDs and account IDs as input** - it cannot discover them from domain names.

```bash
# cf-terraforming REQUIRES zone ID
cf-terraforming generate --resource-type cloudflare_dns_record --zone <ZONE_ID>

# But where do you get the zone ID?
# You must call the Cloudflare API:
curl -s "https://api.cloudflare.com/client/v4/zones?name=example.com" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.result[0].id'
```

**This means:**
1. You configure domain names: `example.com`, `api.example.com`
2. You call the API to get zone IDs
3. You call cf-terraforming with those zone IDs
4. You get Terraform HCL code
5. You need to convert HCL back to configuration data for migration

**vs. CloudflareBackup:**
1. You configure domain names: `example.com`, `api.example.com`
2. CloudflareBackup calls the API to get zone IDs AND configuration data
3. You get configuration data ready for migration

**Why add steps 3-5 when step 2 already gives you what you need?**

### The "Pointless Detour" Problem

```
User's Goal: Migrate from Cloudflare to AWS
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Option 1: cf-terraforming (the long way)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Call API to get zone IDs                                â”‚
â”‚ 2. Call cf-terraforming to get Terraform HCL               â”‚
â”‚ 3. Parse HCL to extract configuration data                 â”‚
â”‚ 4. Convert to AWS                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Option 2: CloudflareBackup (the direct way)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Call API to get zone IDs AND configuration data         â”‚
â”‚ 2. Convert to AWS                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**cf-terraforming adds two unnecessary steps** (2 and 3) that provide zero value for migration.

### What cf-terraforming Actually Does

cf-terraforming is essentially a wrapper that:
1. Calls the Cloudflare API (same as CloudflareBackup)
2. Converts JSON responses to Terraform HCL syntax
3. Outputs Terraform code

**For migration, you need the data from step 1, not the code from step 3.**

Using cf-terraforming for migration is like:
- Translating English â†’ French â†’ English (instead of just using English)
- Converting JSON â†’ HCL â†’ JSON (instead of just using JSON)
- Taking a detour through a different city to reach your destination

### The "Still Need API" Examples

#### Example 1: Getting Zone IDs
```bash
# cf-terraforming cannot do this:
cf-terraforming generate --resource-type cloudflare_dns_record --domain example.com
# Error: unknown flag: --domain

# You MUST use the API:
ZONE_ID=$(curl -s "https://api.cloudflare.com/client/v4/zones?name=example.com" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.result[0].id')

# Then call cf-terraforming:
cf-terraforming generate --resource-type cloudflare_dns_record --zone $ZONE_ID
```

#### Example 2: Getting List Items
```bash
# cf-terraforming requires list ID:
cf-terraforming generate --resource-type cloudflare_list_item \
  --account $ACCOUNT_ID --resource-id "cloudflare_list_item=$LIST_ID"

# Where do you get list IDs? From the API:
curl -s "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rules/lists" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.result[].id'
```

#### Example 3: Getting Account IDs
```bash
# cf-terraforming requires account ID:
cf-terraforming generate --resource-type cloudflare_list --account $ACCOUNT_ID

# Where do you get account ID? From the API:
curl -s "https://api.cloudflare.com/client/v4/zones/$ZONE_ID" \
  -H "Authorization: Bearer $TOKEN" | jq -r '.result.account.id'
```

**In every case, you're already calling the API that returns the configuration data you need.**

### The Real Comparison

| Step | cf-terraforming Approach | CloudflareBackup Approach |
|------|-------------------------|---------------------------|
| 1. Get zone ID | Call API âœ“ | Call API âœ“ |
| 2. Get config data | Call cf-terraforming | Already have it from step 1 |
| 3. Parse HCL | Parse Terraform syntax | N/A |
| 4. Extract config | Convert HCL â†’ JSON | N/A |
| 5. Migrate to AWS | Use conversion tool | Use conversion tool |

**cf-terraforming adds 3 extra steps (2, 3, 4) that accomplish nothing for migration.**

### What cf-terraforming Is Actually For

cf-terraforming is designed for a completely different use case:

**Use Case: Adopt Terraform for Cloudflare Management**
```
Current State: Managing Cloudflare via Dashboard/API
Goal: Manage Cloudflare via Terraform
Solution: cf-terraforming generates Terraform code
Result: Continue using Cloudflare, now with IaC
```

**NOT for: Migrating from Cloudflare to AWS**
```
Current State: Using Cloudflare
Goal: Migrate to AWS
Solution: ??? cf-terraforming generates Cloudflare Terraform code ???
Result: You still need to convert to AWS (cf-terraforming doesn't help)
```

### The "But I Already Use cf-terraforming" Argument

**Q: "I already use cf-terraforming to manage my Cloudflare infrastructure. Can't I just use those files?"**

**A: No, because:**

1. **You still need fresh data from the API**
   - Your `.tf` files might be outdated
   - Migration requires current configuration
   - You'd need to run cf-terraforming again anyway

2. **cf-terraforming output is for Terraform, not migration**
   - Contains Terraform-specific syntax (variables, references, functions)
   - Missing metadata needed for conversion (IDs, timestamps, enabled status)
   - Optimized for Terraform state management, not data extraction

3. **You'd still need to call the API**
   - To get zone IDs for cf-terraforming
   - To get account IDs for cf-terraforming
   - To get list IDs for list items
   - **At which point you already have the data CloudflareBackup would give you**

**Better approach:**
- Keep using cf-terraforming for Cloudflare management
- Run CloudflareBackup once for migration (5 minutes)
- Use this tool to migrate to AWS
- Continue using cf-terraforming for Cloudflare (if you keep it running)

### Design Decision: No Pointless Detours

This tool rejects cf-terraforming support because:

1. âŒ **Requires API anyway**: Can't avoid calling the API for zone/account IDs
2. âŒ **Adds complexity**: HCL parsing, format conversion, error handling
3. âŒ **Provides no benefit**: API already returns the data we need
4. âŒ **More user work**: Multiple commands vs. one command
5. âŒ **Maintenance burden**: Two input formats to support and test

vs. CloudflareBackup:

1. âœ… **One API call**: Gets zone IDs AND configuration data
2. âœ… **Simple format**: JSON from API, no conversion needed
3. âœ… **Direct path**: API â†’ Migration tool â†’ AWS
4. âœ… **One command**: User runs one script, done
5. âœ… **Single format**: Only JSON to support and test

**If you're going to call the API anyway (which you must), get the data you actually need in the format you actually need it.**

### The Bottom Line

Supporting cf-terraforming would be like:
- Building a bridge to nowhere
- Adding a middleman who charges a fee but provides no service
- Converting dollars to euros to dollars when you're already in the US

**It's not just unnecessary - it's counterproductive.**

## Related Resources

- [Kiro Documentation](https://kiro.dev/docs/)
- [Agent Skills Support in Kiro CLI](https://kiro.dev/changelog/cli/1-24/)
- [AWS WAF Documentation](https://docs.aws.amazon.com/waf/)
- [CloudFront Functions Documentation](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/cloudfront-functions.html)

## Roadmap

### ğŸš§ Skills 3-11: Complete CDN Configuration Migration Solution (Architecture Design Phase)

We are designing a comprehensive CDN configuration migration solution that refactors the current single skill into multiple specialized skills:

**Architecture Design Documents:**
- [Skill 3-11 Architecture Design (English)](./docs/architecture/skill-3-11-design-EN.md)
- [Skill 3-11 æ¶æ„è®¾è®¡ (ä¸­æ–‡)](./docs/architecture/skill-3-11-design-CN.md)
- [Architecture Changelog](./docs/architecture/CHANGELOG.md)

**Planned Skills:**

| Skill | Responsibility | Output | Status |
|-------|---------------|--------|--------|
| **Skill 3** | Config Analyzer - Parse Cloudflare CDN config and group by hostname | Hostname-based config summary + user input template | ğŸ¨ Architecture Design |
| **Skill 4** | Implementation Planner - Determine CloudFront implementation methods | Implementation plan | ğŸ¨ Architecture Design |
| **Skill 5** | Plan Validator - Verify implementation plan correctness | Validation report (critical: wrong plan = wrong converters) | ğŸ¨ Architecture Design |
| **Skill 6** | Task Orchestrator - Generate task assignments and execution guide | Task assignment files, execution guide | ğŸ¨ Architecture Design |
| **Skill 7** | Viewer Request Function Converter | CloudFront Function code (one file per domain) | ğŸ“ To Be Designed |
| **Skill 8** | Viewer Response Function Converter | CloudFront Function code (one file per domain) | ğŸ“ To Be Designed |
| **Skill 9** | Origin Request Lambda Converter | Lambda@Edge code | ğŸ“ To Be Designed |
| **Skill 10** | Origin Response Lambda Converter | Lambda@Edge code | ğŸ“ To Be Designed |
| **Skill 11** | CloudFront Config Generator | Terraform configuration, deployment guide | ğŸ“ To Be Designed |

**Key Improvements:**
- âœ… **Subagent architecture from day one** - All Skills (3-11) implemented as Kiro subagents with isolated contexts
- âœ… **Separation of concerns** - Analyzer (parse), Planner (decide), Validator (verify), Orchestrator (assign)
- âœ… **User decision before planning** - Business context informs technical implementation decisions
- âœ… **Plan validation** - Catch errors before converters execute (no recovery after conversion)
- âœ… **Domain-based rule grouping** - Meets CloudFront Function 10KB size limit
- âœ… **Implementation-based task assignment** - Not by Cloudflare rule type
- âœ… **Multi-stage conversion workflow** - Analyze â†’ Decide â†’ Plan â†’ Validate â†’ Orchestrate â†’ Convert â†’ Deploy
- âœ… **Cost-aware design** - Mark high-cost solutions (Viewer Lambda@Edge) as non-convertible
- âœ… **Stateless workflow** - State transfer via Markdown files, supports batch processing
- âœ… **Automation scripts** - One-command installation and configuration

**Impact After Implementation:**

âš ï¸ **When Skills 3-11 are implemented, the current `cf-functions-converter` will be deprecated.**

Reasons:
- Skills 3-11 provide more complete CDN configuration conversion (not just Functions)
- Domain-based grouping better handles Function size limits
- Supports more complex conversion scenarios (Lambda@Edge, Policies, Cache Behaviors)
- Clearer workflow and task assignment with validation

**Timeline:**
- 2026 Q1: Complete architecture design, implement Skill 3 (Analyzer) as subagent prototype
- 2026 Q2: Implement Skills 4-11 as subagents with context isolation
  - Provide automation scripts for Kiro Skills installation and subagent configuration
  - Deprecate `cf-functions-converter`
- 2026 Q3: Optimize subagent workflow and user experience
  - Performance tuning for parallel subagent execution
  - Enhanced error handling and recovery mechanisms
  - User experience improvements based on feedback

---

## Feedback and Contributions

For issues or suggestions, please submit an Issue or Pull Request.
